---
layout: post
title: "Analysing the World Cup 2022 with expected threat"
subtitle: ""
background: '/img/posts/pitch-positioning/header.jpg'
---
### Introduction 

Expected Threat (xT) is a discrete time Markov chain model that measures the probability of a goal being scored from a particular zone of a pitch. The pitch is usually split in 16 by 12 (length x width), resulting in 192 available zones. 
Once the pitch is split, you can calculate the xT of given zone by the following formula: 

$$
xT_{x, y} = (s_{x, y} \times g_{x, y}) + (m_{x, y} \times \sum_{l=1}^{16} \sum_{w=1}^{12} T_{(x, y)} \rightarrow _{(l, w)}xT_{l,w})
$$

$$
s_{x, y}
$$
is the probability of taking a shot from particular zone.
$$
m_{x, y}
$$
is the probability of player move from particular zone via dribble or pass. Since the xT model assumes players can only move or shoot given the location, 
$$
s_{x, y} + m_{x, y} = 1.
$$

Finally, 
$$
 g_{x, y}
$$
is the probability of goals being scored from particular zone. 
$$
\sum_{l=1}^{16} \sum_{w=1}^{12} T_{(x, y)} \rightarrow _{(l, w)}xT_{l,w}
$$
is the probability of moving from one particular zone to all other zones including itself, multiplied by the values of these zones. 

Initially, 
$$
xT_{l,w} 
$$
is set to 0, and iterate *n* times untill convergence, meaning the probabiliy of a goal scored in the next *n* actions.

This way, we can calculate cumulative xT for all actions performed by a player, compare the value among other players to evaluate individual performance. Or we can calculate xT per team to see where the team creates scoring opportunities. 

### Data 
The data source for this project is Statsbomb open data. The data was extracted and processed to create two dataframes, *event_data* and *player_data*.

*event_data* is data regarding pitch event and desctiptors of the event, such as:

* *event_type*: The type of action performed by a player, such as a dribble, pass, or shot.
* *player_id*: A unique identifier assigned to each player.
* *player_name*: The name of the player associated with the action.
* *x_start*: The starting x-coordinate of the action on the pitch.
* *y_start*: The starting y-coordinate of the action on the pitch.
* *x_end*: The ending x-coordinate of the action on the pitch.
* *y_end*: The ending y-coordinate of the action on the pitch.
* *outcome*: The result of the action, 1 = sucessful and 0 otherwise.

*player_data* is data regarding players, including the following features:

* *player_id*: A unique identifier assigned to each player.
* *player_nickname*: The name of the player.
* *country_name*: The name of the country associated with the player.
* *total_play_time*: The total amount of time the player has played during the world cup 2022. 

Once the data was prepared, *event_data* was used to assign xT value to each 192 location. Based on the grids with the obtained xT values, we can evaluate all move actions (pass and dribble) given the starting and ending locations of the action. 

For example, if Kasper Schmeichel makes a successful long pass from a zone near his own goal (xT = 0.138442) to the zone near the opponent half (xT = 0.172552), the xT value for this pass is 
$$
0.172552 - 0.138442 = 0.034111.
$$
This indicates that there is a 3% of chance of goal being scored in the next few actions.

Once xT was calculated for all sucessful move actions, we calculated the cumulative xT per player, normalised to 90 mins by using *total_play_time* from *player_data*. 

### Result
### Individual Performance
The figure shows the Expected Threat (xT) generated per 90 minutes. Notably, it highlights a discernible trend indicating that a greater proportion of xT is produced through passes rather than dribbles. This observation reflects the defensive playing styles adopted by teams during the World Cup, which limited spaces in the advantageous areas for dribblers to exploit. However, one particularly intriguing outlier that deserves attention is Jamal Musiala, who remarkably generated an xT of over 0.4 per 90 minutes through dribbles. This exceptional performance sets Musiala apart and underscores his remarkable ability to create goal-scoring opportunities.

![xt-per-player](/img/posts/world-cup/expected-threat-player.png)

The bar graph further demonstrates that more scoring opportunities were created by passes during the World Cup. Musiala, Mbappé, and Vinícius emerged as the top 3 dribblers in terms of dribble xT, while Kimmich, Raphina, and Zieliński led in creating chances through passes.

![xt-per-player-bar](/img/posts/world-cup/expected-threat-player-bar.png)

### Team Performance 

xT can also be employed to assess a team's tactical behaviors in possession. The following figure presents the calculated xT per **team**. It is evident that certain teams exhibit preferences for specific areas when in possession.
![xt-per-country](/img/posts/world-cup/xt-per-country.png)
